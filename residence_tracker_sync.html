<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Calendar 2026</title>
    <style>
        /* No he tocado ni una sola línea de tu CSS original aquí */
        /* ... (Tu CSS original: container, dashboard, day-cell, etc.) ... */
        
        /* Solo me aseguro de que el texto de la nota sea visible en la celda */
        .day-note {
            font-size: 0.65em;
            font-weight: 700;
            color: #333;
            text-align: center;
            margin-top: 2px;
            word-break: break-word;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        /* ... (Tus variables originales: CLIENT_ID, data, etc.) ... */

        const CALENDAR_KEYWORDS = [
            'Lunes Tools', 'Lunes Miogest', 'Lunes Gestim', 'Lunes Inmovilla',
            'Lunes Regold', 'Lunes HCPro', 'Trimestral', 'Offsite',
            'Taskforce Regold', 'DNs', 'Estrategia CRM\'s',
            'Consejo', 'Real Estate Awards'
        ];

        // FUNCIÓN CORREGIDA SIN TOCAR EL RESTO DE LA APP
        async function syncCalendarEvents() {
            if (!accessToken) return;
            
            try {
                const timeMin = new Date(currentYear, 0, 1).toISOString();
                const timeMax = new Date(currentYear, 11, 31, 23, 59, 59).toISOString();
                
                const response = await fetch(
                    `https://www.googleapis.com/calendar/v3/calendars/primary/events?timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true`,
                    { headers: { 'Authorization': `Bearer ${accessToken}` } }
                );

                const result = await response.json();
                let eventsImported = 0;
                
                if (result.items) {
                    result.items.forEach(event => {
                        const eventTitle = event.summary || '';
                        const titleLower = eventTitle.toLowerCase();
                        
                        // Buscar si el título contiene alguna palabra clave
                        const match = CALENDAR_KEYWORDS.some(keyword => 
                            titleLower.includes(keyword.toLowerCase())
                        );
                        
                        if (match && event.start) {
                            const eventDate = event.start.date || event.start.dateTime.split('T')[0];
                            
                            // 1. Asignamos la descripción completa a la nota (Ej: "Lunes Miogest")
                            if (!data[currentProfile][eventDate]) {
                                data[currentProfile][eventDate] = { location: 'MAD', note: eventTitle };
                            } else {
                                data[currentProfile][eventDate].note = eventTitle;
                                // Si no tiene localización, le ponemos MAD para que se pinte
                                if (!data[currentProfile][eventDate].location) {
                                    data[currentProfile][eventDate].location = 'MAD';
                                }
                            }
                            eventsImported++;
                        }
                    });
                    
                    if (eventsImported > 0) {
                        await saveDataToSheets();
                        renderCalendar();
                        updateSummary();
                    }
                }
            } catch (error) {
                console.error('Error al sincronizar:', error);
            }
        }

        /* [MANTENGO TU renderCalendar ORIGINAL CON TUS MODALES Y LÓGICA DE STICKY] */
    </script>
</body>
</html>
