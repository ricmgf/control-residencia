<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Calendar 2026</title>
    <style>
        /* ... (Tus estilos originales se mantienen igual) ... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 10px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .dashboard { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 15px; }
        @media (min-width: 1025px) { .dashboard { grid-template-columns: 1fr 500px; } }
        
        /* Estilos de las celdas para que quepa el texto del evento */
        .calendar-month { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .day-cell { 
            aspect-ratio: 1; border: 2px solid #e0e0e0; border-radius: 6px; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 95px; padding: 4px; cursor: pointer; position: relative; overflow: hidden;
        }
        .day-number { font-weight: bold; font-size: 0.9em; margin-bottom: 2px; }
        .day-note { 
            font-size: 0.65em; font-weight: 700; text-align: center; 
            line-height: 1.2; color: #333; word-break: break-word;
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
        }
        
        /* Colores de fondo */
        .color-MAD { background-color: #FFEB3B !important; }
        .color-AND { background-color: #2196F3 !important; color: white !important; }
        /* ... resto de colores ... */
    </style>
</head>
<body>
    <div class="container" id="mainApp">
        <div class="header">
            <h1>Travel Calendar</h1>
            <div class="profile-selector">
                <button class="profile-btn active" onclick="switchProfile('RG')">Ricardo</button>
                <button class="profile-btn" onclick="switchProfile('SB')">Sylvia</button>
            </div>
        </div>
        <div class="dashboard">
            <div class="calendar-section">
                <div id="calendar"></div>
            </div>
            <div class="summary-section">
                <div id="monthlyBars"></div>
                <div id="monthlyTable"></div>
            </div>
        </div>
    </div>

    <script>
        const CLIENT_ID = '62569860135-87ahagt2aflno2e0o022l44iovnk2de4.apps.googleusercontent.com';
        const SPREADSHEET_ID = '1ED2d1fsBUumzodJV036hvd0h1yfgVNb9bF-WYTqC3qk';
        
        // Tus palabras clave para filtrar
        const CALENDAR_KEYWORDS = ['trimestral', 'lunes', 'estrategia', 'offsite', 'real estate awards', 'dns'];

        let data = { RG: {}, SB: {} };
        let currentProfile = 'RG';
        let currentYear = 2026;

        async function syncCalendarEvents() {
            if (!accessToken) return;
            
            try {
                const timeMin = new Date(currentYear, 0, 1).toISOString();
                const timeMax = new Date(currentYear, 11, 31).toISOString();
                
                const response = await fetch(
                    `https://www.googleapis.com/calendar/v3/calendars/primary/events?timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true`,
                    { headers: { 'Authorization': `Bearer ${accessToken}` } }
                );

                const result = await response.json();
                let hasChanges = false;

                if (result.items) {
                    result.items.forEach(event => {
                        const eventSummary = event.summary || '';
                        const summaryLower = eventSummary.toLowerCase();
                        
                        // Verificar si el evento contiene alguna palabra clave
                        const match = CALENDAR_KEYWORDS.some(kw => summaryLower.includes(kw.toLowerCase()));

                        if (match) {
                            const dateKey = event.start.date || event.start.dateTime.split('T')[0];
                            
                            // Si no hay datos previos para ese día, o no hay nota
                            if (!data[currentProfile][dateKey] || data[currentProfile][dateKey].note !== eventSummary) {
                                data[currentProfile][dateKey] = {
                                    location: 'MAD', // Lo pintamos (puedes cambiar la lógica si prefieres otro color)
                                    note: eventSummary // <--- AQUÍ TRAE LA DESCRIPCIÓN COMPLETA (Ej: Lunes Miogest)
                                };
                                hasChanges = true;
                            }
                        }
                    });
                }

                if (hasChanges) {
                    await saveDataToSheets();
                    renderCalendar();
                    updateSummary();
                }
            } catch (error) {
                console.error("Error al sincronizar calendar:", error);
            }
        }

        function renderCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = '';
            const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

            for (let m = 0; m < 12; m++) {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'calendar-month';
                monthDiv.innerHTML = `<div style="text-align:center;font-weight:bold;margin-bottom:10px;">${months[m]}</div>`;
                
                const grid = document.createElement('div');
                grid.className = 'calendar-grid';

                // Días de la semana
                ['L','M','X','J','V','S','D'].forEach(d => {
                    grid.innerHTML += `<div style="text-align:center;font-size:0.7em;font-weight:bold;color:#999;">${d}</div>`;
                });

                const firstDay = new Date(currentYear, m, 1).getDay();
                const offset = firstDay === 0 ? 6 : firstDay - 1;
                const daysInMonth = new Date(currentYear, m + 1, 0).getDate();

                for (let i = 0; i < offset; i++) grid.innerHTML += '<div></div>';

                for (let d = 1; d <= daysInMonth; d++) {
                    const dateKey = `${currentYear}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                    const dayData = data[currentProfile][dateKey] || {};
                    
                    const cell = document.createElement('div');
                    cell.className = `day-cell ${dayData.location ? 'color-' + dayData.location : ''}`;
                    
                    cell.innerHTML = `
                        <span class="day-number">${d}</span>
                        <div class="day-note">${dayData.note || ''}</div>
                    `;
                    
                    cell.onclick = () => handleDayClick(dateKey);
                    grid.appendChild(cell);
                }
                monthDiv.appendChild(grid);
                calendarEl.appendChild(monthDiv);
            }
        }

        // ... resto de funciones de guardado y perfiles ...
    </script>
</body>
</html>
